# Firebase Module — Post-Terraform Setup

After running `terraform apply`, complete these manual steps to finish the
Firebase integration.

## 1. Download Firebase Config Files

The config files are **not** auto-generated by Terraform; use the commands
below after `terraform apply` succeeds.

```bash
# Android — google-services.json
gcloud firebase apps sdkconfig ANDROID $(terraform output -raw firebase_android_app_id) \
  > ../../../../android/app/google-services.json

# iOS — GoogleService-Info.plist
gcloud firebase apps sdkconfig IOS $(terraform output -raw firebase_ios_app_id) \
  > ../../../../ios/Runner/GoogleService-Info.plist
```

Then commit both files (they contain **no secrets** — they're safe to store
in version control for non-production apps).

## 2. Enable App Check — iOS DeviceCheck Key

The `google_firebase_app_check_device_check_config` resource requires a
DeviceCheck private key from Apple. This is a **one-time** manual step:

1. Sign in to [Apple Developer portal](https://developer.apple.com) →
   Certificates, IDs & Profiles → Keys.
2. Create a new key with **DeviceCheck** capability. Note the 10-character
   **Key ID**.
3. Download the `.p8` private key file.
4. Add to `terraform.tfvars` (never commit this file):

   ```hcl
   app_check_key_id      = "XXXXXXXXXX"
   app_check_private_key = "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
   ```

5. Re-run `terraform apply` — the DeviceCheck config will be created.

## 3. Verify in Firebase Console

Open [console.firebase.google.com](https://console.firebase.google.com) →
your project → App Check, and confirm:

- Android app shows **Play Integrity** as the provider.
- iOS app shows **DeviceCheck** as the provider (after step 2).
- Both show enforcement mode **Enforced** (or **Monitor** until you're
  confident all clients are sending valid tokens).
